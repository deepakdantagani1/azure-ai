/**
 * Define projections :  data to be stored in your knowledge store
 * The projections of data to be stored in your knowledge store are based on the document structures generated by the enrichment 
 * pipeline in your indexing process
 */

/**
 * Using the Shaper skill
 * The Shaper skill in the pipeline is used to reorganize and reshape the enriched data, creating a more structured, simplified 
 * representation that can be stored as a projection.
 */

/**
 * ex: 
 * 
 * input:
 * 
 * {
  "@odata.type": "#Microsoft.Skills.Util.ShaperSkill",
  "name": "define-projection",
  "description": "Prepare projection fields",
  "context": "/document",
  "inputs": [
    {
      "name": "file_name",
      "source": "/document/metadata_content_name"  // Gets the file name from the metadata
    },
    {
      "name": "url",
      "source": "/document/url"  // Gets the URL of the document
    },
    {
      "name": "sentiment",
      "source": "/document/sentimentScore"  // Gets the sentiment score from the document
    },
    {
      "name": "key_phrases",
      "source": null,
      "sourceContext": "/document/merged_content/keyphrases/*",
      "inputs": [
        {
          "name": "phrase",
          "source": "/document/merged_content/keyphrases/*"  // Retrieves key phrases
        }
      ]
    }
  ],
  "outputs": [
    {
      "name": "output",
      "targetName": "projection"  // Outputs a "projection" with the simplified structure
    }
  ]
}


output:
{
  "file_name": "file_name.pdf",
  "url": "https://<storage_path>/file_name.pdf",
  "sentiment": 1.0,
  "key_phrases": [
    { "phrase": "first key phrase" },
    { "phrase": "second key phrase" },
    { "phrase": "third key phrase" }
  ]
}


 */

/**
 * final out indexer
 * 
 * {
  "metadata_storage_name": "document_name.pdf",
  "metadata_storage_path": "https://<storage_account>.blob.core.windows.net/documents/document_name.pdf",
  "metadata_author": "John Doe",
  "metadata_storage_size": 102400,  // Size in bytes
  "metadata_storage_last_modified": "2023-10-06T12:34:56Z",
  "metadata_content_type": "application/pdf",
  
  "content": "This is the main body text extracted from the document. It could be large and contain multiple paragraphs, sections, etc.",
  
  "normalized_images": {
    "image0": {
      "Text": "Extracted text from the first image in the document."
    },
    "image1": {
      "Text": "Extracted text from the second image in the document."
    }
  },
  
  "language": "en",
  
  "sentimentScore": 0.85,  // A positive sentiment score (0.0 to 1.0)
  
  "keyPhrases": [
    "key phrase 1",
    "key phrase 2",
    "important term 3",
    "main topic"
  ],
  
  "entities": [
    {
      "name": "Microsoft",
      "type": "Organization",
      "confidence": 0.98
    },
    {
      "name": "Azure Cognitive Search",
      "type": "Product",
      "confidence": 0.97
    }
  ],

  "projection": {
    "file_name": "document_name.pdf",
    "url": "https://<storage_account>.blob.core.windows.net/documents/document_name.pdf",
    "sentiment": 0.85,
    "key_phrases": [
      {
        "phrase": "key phrase 1"
      },
      {
        "phrase": "key phrase 2"
      },
      {
        "phrase": "important term 3"
      },
      {
        "phrase": "main topic"
      }
    ]
  },

  "@search.score": 1.0,  // This is the relevance score from the search indexer

  "@search.highlights": {
    "content": [
      "This is a <em>highlighted</em> portion of the text that matches the search."
    ]
  }
}

 */

/**
 * ==> metadata_storage_name : The name of the document as stored in the metadata
 * ==> metadata_storage_path : The URL of the document in the storage account
 * ==> metadata_author : The author of the document
 * ==> metadata_storage_size : The size of the document in bytes
 * ==> metadata_storage_last_modified : The date and time the document was last modified
 * ==> metadata_content_type : The content type of the document
 * ==> content : The main body text extracted from the document
 * ==> normalized_images : Extracted text from images in the document
 * ==> language : The language of the document
 * ==> sentimentScore : The sentiment score of the document
 * ==> keyPhrases : Key phrases extracted from the document
 * ==> entities : Entities extracted from the document
 * ==> projection : The simplified projection of the document
 * ==> @search.score : The relevance score from the search indexer
 * ==> @search.highlights : Highlighted portions of the text that match the search
 */